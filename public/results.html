<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>투표 결과</title>
    <link rel="stylesheet" href="css/results.css">
</head>
<body>
    <div class="results-container">
        <h2 id="voteTitle">투표 결과</h2>
        <div id="resultsContainer" class="results-content">결과를 불러오는 중...</div>
        <button id="goHomeButton" class="home-button">홈으로 돌아가기</button>

    <script>
        const goHomeButton = document.getElementById('goHomeButton');
        goHomeButton.addEventListener('click', () => {
            window.location.href = 'home.html'; // 홈 페이지로 이동
        });
        // URL에서 voteId 추출
        const urlParams = new URLSearchParams(window.location.search);
        const voteId = urlParams.get('voteId');

        if (!voteId) {
            alert('잘못된 접근입니다.');
            window.location.href = 'home.html'; // 잘못된 접근 시 홈으로 리디렉션
        }

        const resultsContainer = document.getElementById('resultsContainer');
        const voteTitle = document.getElementById('voteTitle');

        // 서버에서 결과 가져오기
        const fetchResults = async () => {
            try {
                const response = await fetch(`https://ttny7pmcv4.execute-api.ap-northeast-2.amazonaws.com/dev/results/${voteId}`);
                if (!response.ok) throw new Error('Failed to fetch vote results');

                const data = await response.json();
                renderResults(data);
            } catch (error) {
                console.error('Error fetching vote results:', error);
                resultsContainer.textContent = '결과를 불러올 수 없습니다.';
            }
        };

        // 결과 렌더링
        const renderResults = (data) => {
            voteTitle.textContent = data.title; // 투표 제목 설정
            resultsContainer.innerHTML = ''; // 기존 내용을 초기화

            const optionsList = document.createElement('ul');
            Object.entries(data.options).forEach(([option, count]) => {
                const listItem = document.createElement('li');
                listItem.textContent = `${option}: ${count} 표`;
                optionsList.appendChild(listItem);
            });

            resultsContainer.appendChild(optionsList);
        };

        // 결과 데이터 로드
        fetchResults();
    </script>
</body>
</html>
