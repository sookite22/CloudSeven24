<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>로그인</title>
    <!-- 파비콘 설정 -->
    <link rel="icon" href="public/favicon.ico" type="image/x-icon">
</head>
<body>
    <h2>로그인</h2>
    <form id="loginForm">
        <input type="text" id="login-username" placeholder="아이디" required>
        <input type="password" id="login-password" placeholder="비밀번호" required>
        <button type="submit" onclick="loginUser()">로그인</button>
    </form>
    <div id="message"></div>
    <p>회원이 아니신가요? <a href="signup.html">회원가입</a></p>

    <!-- JavaScript 코드 -->
    <script>
        async function loginUser() {
            const username = document.getElementById("login-username").value;
            const password = document.getElementById("login-password").value;

            // 유효성 검사
            if (!username || !password) {
                alert("사용자 이름과 비밀번호를 입력하세요.");
                return;
            }

            try {
                // AWS API Gateway URL
                const apiUrl = "https://0tzdwtrc28.execute-api.ap-northeast-2.amazonaws.com/prod/loginUser";

                console.log("로그인 요청 시작:", { username });

                // Lambda 함수로 요청 전송
                const response = await fetch(apiUrl, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ username, password })
                });

                console.log("응답 수신:", response);

                // 응답 처리
                const result = await response.json();

                if (response.ok) {
                    console.log("로그인 성공:", result);
                    alert("로그인 성공: " + result.message);
                    window.location.href = "index.html"; // 로그인 성공 후 메인 페이지로 리디렉션
                } else {
                    console.error("로그인 실패, 상태코드:", response.status, "응답 내용:", result);
                    alert("로그인 실패: " + (result.message || "알 수 없는 오류"));
                }
            } catch (error) {
                console.error("Fetch error 발생:", error);
                alert("서버와 통신하는 동안 오류가 발생했습니다.");
            }
        }
    </script>
</body>
</html>
